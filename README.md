# oxidize experiments

This repo contains some initial code exploring low-level parsing and access to
font data types in rust. See
[googlefonts/oxidize](https://github.com/googlefonts/oxidize) for more
background.

## contents

- `font-types` is an early attempt at a high-level API representing the core
  scalar types, and how to efficiently handle reading them.
- `font-types-macro` contains a function-like proc macro that implements a DSL
  for describing arbitrary font-like-things (tables, records, etc).
- `font-tables` contains tables and record definitions generated by the macro.

The `retired_crates` directory contains some earlier experiments:

- `toy-types` is a highly simplified version of this API. This is supposed to be
  easy to work with while experimenting with macros etc.
- `toy-types-derive` contains a derive macro that can be used to describe types
  which represent various font tables and records.
- `raw-types` is a set of simple zerocopy types, intended to be the basis for,


## codegen

This crate relies heavily on automatically generated code. This is a two part
process: a procedural macro (implemented in the `font-types-macro`) is used to
generate the final code, but much of the proc macro input is *itself* generated
from the table definitions in the [OpenTypeâ„¢
Specification](https://docs.microsoft.com/en-us/typography/opentype/spec/). This
raw input is stored in text files in `resources/tables`.

How this works:

1. Table definitions are copied directly from the spec.
1. annotations are added that provide a name, type information, and top-level
   docs for a given table/record/flagset
1. this is run through the `codegen` binary (`font-types-macro/src/bin/codgen.rs`)
   which parses it and converts it into proc macro declarations
1. this is copied into a Rust file, adding input statements and correctly any
   issues as necessary.
